<% content_for(:title) { "My Saved Searches" } %>

<div class="mx-auto max-w-3xl px-4 py-8">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold">My Saved Searches</h1>
    <span class="text-sm text-gray-500">
      <%= current_user.saved_searches.count %><%= current_user.free? ? "/3" : "" %> searches
      <% if current_user.free? %>
        Â· <a href="<%= pricing_path %>" class="text-indigo-600">Upgrade for unlimited</a>
      <% end %>
    </span>
  </div>

  <% if @saved_searches.any? %>
    <div class="mt-6 space-y-3">
      <% @saved_searches.each do |search| %>
        <div class="flex items-center justify-between rounded-xl border border-gray-100 bg-white p-4 shadow-sm">
          <div class="flex-1">
            <div class="flex items-center gap-2">
              <a href="<%= search_path(q: search.query, brand: search.brand, size: search.size, color: search.color, min_price: search.min_price, max_price: search.max_price) %>"
                 class="font-medium text-gray-900 hover:text-indigo-600">
                <%= search.query %>
              </a>
              <% unless search.active? %>
                <span class="rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-500">Paused</span>
              <% end %>
            </div>
            <p class="mt-1 text-sm text-gray-400">
              <% details = [search.brand, search.size, search.color].compact_blank %>
              <%= details.any? ? details.join(" Â· ") : "No filters" %>
              <% if search.min_price || search.max_price %>
                Â· â‚¬<%= search.min_price || "0" %> â€“ â‚¬<%= search.max_price || "âˆž" %>
              <% end %>
              <% if search.last_checked_at %>
                Â· Last checked <%= time_ago_in_words(search.last_checked_at) %> ago
              <% end %>
            </p>
            <p class="text-xs text-gray-300"><%= search.search_results.count %> results found</p>
          </div>
          <div class="flex items-center gap-2">
            <form action="<%= toggle_saved_search_path(search) %>" method="post">
              <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
              <input type="hidden" name="_method" value="patch">
              <button type="submit" class="rounded-lg px-3 py-1 text-sm text-gray-500 hover:bg-gray-100">
                <%= search.active? ? "Pause" : "Resume" %>
              </button>
            </form>
            <form action="<%= saved_search_path(search) %>" method="post">
              <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
              <input type="hidden" name="_method" value="delete">
              <button type="submit" class="rounded-lg px-3 py-1 text-sm text-red-500 hover:bg-red-50"
                      onclick="return confirm('Delete this saved search?')">
                Delete
              </button>
            </form>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="mt-16 text-center text-gray-400">
      <p class="text-4xl">ðŸ””</p>
      <p class="mt-2 text-lg">No saved searches yet</p>
      <p class="mt-1 text-sm">Search for something and click "Save this search" to get alerts!</p>
      <a href="<%= search_path %>" class="mt-4 inline-block rounded-full bg-black px-6 py-2 text-white text-sm font-medium hover:bg-gray-800 transition">
        Start searching
      </a>
    </div>
  <% end %>

  <% if current_user.free? && current_user.saved_searches.count >= 3 %>
    <div class="mt-8 rounded-2xl bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white text-center">
      <p class="font-semibold text-lg">You've hit your saved search limit</p>
      <p class="mt-1 text-indigo-100 text-sm">Upgrade to Pro for unlimited saved searches, hourly email alerts, and price tracking.</p>
      <a href="<%= pricing_path %>" class="mt-4 inline-block rounded-full bg-white text-indigo-600 px-6 py-2 font-semibold hover:bg-indigo-50 transition">
        Upgrade to Pro â€” â‚¬8/mo
      </a>
    </div>
  <% elsif current_user.free? %>
    <div class="mt-8 rounded-xl border border-indigo-100 bg-indigo-50 p-4 text-center text-sm">
      <p class="text-indigo-900">
        <strong><%= 3 - current_user.saved_searches.count %> saved search<%= 3 - current_user.saved_searches.count == 1 ? "" : "es" %> remaining</strong> on the Free plan.
        <a href="<%= pricing_path %>" class="text-indigo-600 font-medium hover:text-indigo-800">Upgrade to Pro</a> for unlimited searches & email alerts.
      </p>
    </div>
  <% end %>
</div>
